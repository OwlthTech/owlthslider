(()=>{"use strict";jQuery(document).ready((e=>{function t(){e("#os-slider-table tbody tr").each((function(t){e(this).find("input, textarea").each((function(){const s=e(this).attr("name");if(s){const o=s.replace(/\[\d+\]/,`[${t}]`);e(this).attr("name",o)}const o=e(this).attr("id");if(o&&o.includes("os_slider")){const s=o.replace(/(\d+)/,t);e(this).attr("id",s)}const i=e(this).attr("class");if(i){const s=i.split(" ").map((e=>e.includes("os_slider")?e.replace(/(\d+)/,t):e)).join(" ");e(this).attr("class",s)}}))})),o()}function s(e){tinymce.init({selector:`#${e}`,menubar:!1,branding:!1,quicktags:!0,mediaButtons:!1,quickbars_selection_toolbar:"bold italic | quicklink h2 h3",toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright | bullist numlist | link | removeformat | forecolor backcolor",setup:function(e){e.on("change",(function(){tinymce.triggerSave(),o()}))}})}e("#add-slider-row").on("click",(()=>{let o=e("#os-slider-table tbody tr").length,i=e("#table-row-template").html();i=i.replace(/index_count/g,o),e("#os-slider-table tbody").append(i),s(`slides${o}caption`),t()})),e("#os-slider-table tbody tr").each((function(e){s(`slides${e}caption`)})),e("#os-slider-table").on("click",".remove-row",(function(){confirm("Are you sure you want to remove this row?")&&e("#os-slider-table tbody tr").length>1&&(e(this).closest("tr").remove(),t())})),e("#os-slider-table").on("click",".duplicate-row",(function(){const o=e(this).closest("tr").clone();e(this).closest("tr").after(o),t(),s(`slides${e("#os-slider-table tbody tr").length-1}caption`)})),e("#os-slider-table").on("click",".slider-select-image",(function(t){t.preventDefault();const s=e(this);var o=wp.media({title:"Slide Background Image",button:{text:"Set as Slide Background"},multiple:!1}).on("select",(()=>{const e=o.state().get("selection").first().toJSON();console.log("Selected Attachment:",e);const t=s.closest("td").find('input[name*="[background_image]"]');console.log(s.closest("td").find('input[name*="[background_image]"]')),t.val(e.url),console.log("Hidden Input Value After Setting:",t.val()),t.trigger("change"),s.before(`<div class="slider-image-thumbnail"><img src="${e.url}" alt="" /><button type="button" class="button slider-remove-image">&times;</button></div>`),s.closest("td").find('input[name*="[background_image]"]'),s.hide()})).open()})),e("#os-slider-table").on("click",".slider-remove-image",(function(){e(this).closest("td").find('input[name*="background_image"]').val(""),e(this).closest("td").find("button.slider-select-image").show(),e(this).closest(".slider-image-thumbnail").remove(),o()})),e("#os-slider-table tbody").sortable({tolerance:"pointer",revert:"invalid",containment:"parent",animation:200,placeholder:"ui-state-highlight",update(e,s){t()}}),e("#os-slider-table tbody").disableSelection(),e("#post").on("submit",(function(){tinymce.triggerSave()}));const o=function(e){let t;return function(){const s=this,o=arguments;clearTimeout(t),t=setTimeout((function(){t=null,e.apply(s,o)}),1e3)}}((function(){var t=e("#post").serialize();e.ajax({url:os_slider_params.ajax_url,method:"POST",data:{action:"os_auto_save_sliders",os_slider_universal_nonce:os_slider_params.nonce,post_id:os_slider_params.post_id,slider_data:t},success:function(e){e.success?console.log("Slider data saved successfully."):console.error("Error saving slider data:",e.data)},error:function(e,t,s){console.error("AJAX error:",t,s)}})}));e("#post").on("change input","input, select, textarea",o)})),jQuery(document).ready((function(e){e("#os_refresh_reviews").on("click",(function(t){t.preventDefault();var s=e("#os_slider_google_place_id").val();s?confirm("Are you sure you want to refresh the reviews?","owlthslider")&&(e("#os_reviews_table_container").html("<p>Refreshing reviews...</p>"),e.ajax({url:os_slider_params.ajax_url,method:"POST",data:{action:"os_refresh_reviews",os_slider_universal_nonce:os_slider_params.nonce,post_id:os_slider_params.post_id,google_place_id:s},success:function(t){t.success?(e("#os_reviews_table_container").html(t.data),alert("Reviews refreshed successfully.")):(e("#os_reviews_table_container").html(""),alert("Failed to refresh reviews: "+t.data))},error:function(t,s,o){e("#os_reviews_table_container").html(""),console.log(o),alert("AJAX error occurred while refreshing reviews.")}})):alert("Please enter a Google Place ID first.")}))}))})();